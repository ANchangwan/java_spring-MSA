server:
  port: 8000

spring:
  application:
    name: delivery-gateway

  data:
    redis:
      host: localhost
      port: 6379

  cloud:
    gateway:
      routes:
        - id: delivery-service        # ??? ?? ???
          uri: http://localhost:8080  # ?? ??? ??
          predicates:                 # ??
            - Path=/delivery/**       # /delivery/**

          # ??
          # ??? ???(8080)? ???? ?? ??(Pre-fillter)???,
          # ??? ??? ? ??(Post-filter)?? ?? ??
          filters:
            # ?? ??? ?? ?? (?????)
            # /delivery/status ->/status? ???? ???? ?? (???? ??? ??? ?? ??? ???? ??)
            - RewritePath=/delivery/(?<segment>.*), /$\{segment}
            - AddRequestHeader=X-Gateway-Source, delivery-gateway
            - name: RequestRateLimiter
              args:
                # [?? 1] ?? ???? ??? ?? (???)
                # ?? 1?? ?? ??. ?, ?????? ?? 1? ??? ??
                # ?? ?: 10~20, ?? ?: 2~5, ??? API: 0.5~1
                redis-rate-limiter.replenishRate: 1

                # [?? 2] ??? ?? ?? (?? ??? ???: ?? ???? 1.5~2? ??)
                # ??? ?? ???, ????? ?? 5? ????? ???? ??
                # ?? ?: 20~40, ?? ?: 5~10, ??? API: 1
                redis-rate-limiter.burstCapacity: 5

                # [?? 3] ?? ?? (Key Resolver)
                # "??? ???? ???? ????"? ???? ?(Bean) ?? (???? ?? ? ??? keyResolver)
                # Java Config? ??? userKeyResolver ???? ?? ??
                key-resolver: "#{@userKeyResolver}"

# Actuator
management:
  endpoints:
    web:
      exposure:
        include: gateway, health
  endpoint:
    gateway:
      access: read-only
